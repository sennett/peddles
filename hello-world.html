<!DOCTYPE html>
<!-- HTML5 Hello world by kirupa - http://www.kirupa.com/html5/getting_your_feet_wet_html5_pg1.htm -->
<html lang="en-us">

<head>
<meta charset="utf-8">
<title>Hello peddles</title>
</head>

<script src="/bower_components/jquery/dist/jquery.js"></script>
<script src="/bower_components/underscore/underscore.js"></script>
<script src="/bower_components/backbone/backbone.js"></script>

<body>

<script type="text/template" id="gainControl">
	Gain: <%= gain %>
	<button class="down">down</button>
	<button class="up">up</button>
</script>

<div id="gainControlTarget"></div>
<button onclick="toggle()">start or stop</button>

<script>

var context = new AudioContext, oscillator, gain;

gain = context.createGain();
gain.gain.value = 0;
gain.connect(context.destination);

var running = false;
var toggle = function(){
	if (running)
		oscillator.stop();
	else {
		oscillator = context.createOscillator();
		oscillator.frequency.value = 200;
		
		oscillator.connect(gain);
		oscillator.start(0);
	}
	running = !running;
};

var GainModel = Backbone.Model.extend({
	defaults: {
		gain: 0
	},
	initialize: function(){
		_.bindAll(this, 'update');
		this.on('change', this.update);
	},
	update: function(){
		gain.gain.value = this.attributes.gain;
	}
});

var GainView = Backbone.View.extend({
	el: "#gainControlTarget",
	
	template: _.template($('#gainControl').html()),
	
	events: {
		"click button.up": "increase",
		"click button.down": "decrease"
	},
	
	increase: function(){
		this.model.set('gain', this.model.attributes.gain + 1);
	},
	
	decrease: function(){
		this.model.set('gain', this.model.attributes.gain - 1);
	},
	
	initialize: function(){
		_.bindAll(this, 'render');
		this.listenTo(this.model, 'change', this.render);
		this.render();
	},
	
	render: function(){
		this.$el.html(this.template(this.model.attributes));
	}
});

var gainView = new GainView({model: new GainModel() });

</script>

</body>
</html>
